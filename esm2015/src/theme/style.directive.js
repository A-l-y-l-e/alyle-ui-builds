var LyStyle_1;
import * as tslib_1 from "tslib";
import { Directive, Input, SimpleChange } from '@angular/core';
import { StyleCollection } from '../parse';
import { eachMedia } from '../style-utils';
import { LyHostClass } from '../minimal/host-class';
import { StyleRenderer } from '../minimal/renderer-style';
const STYLE_PRIORITY = -0.5;
let LyStyle = LyStyle_1 = class LyStyle {
    constructor(_sr, _hClass) {
        this._sr = _sr;
        this._hClass = _hClass;
    }
    get lyStyle() {
        return this._lyStyle;
    }
    set lyStyle(val) {
        if (typeof val === 'function') {
            this._sr.add(val);
        }
        else {
            this._updateStyle(0xa, 'style', val, () => eachMedia(val, (v, media) => ((className) => `@media ${media || 'all'}{${className}{${v};}}`), new StyleCollection()));
        }
    }
    _updateStyle(index, styleId, simpleChange, style) {
        if (simpleChange) {
            const currentValue = simpleChange instanceof SimpleChange
                ? simpleChange.currentValue
                : simpleChange;
            if (currentValue != null) {
                this[index] = this._sr.add(`${LyStyle_1.и}--${styleId}-${currentValue}`, style, STYLE_PRIORITY, this[index]);
            }
            else {
                this._hClass.remove(this[index]);
            }
        }
    }
    ngOnChanges({ p, pf, pe, pt, pb, px, py, m, mf, me, mt, mb, mx, my, display, width, maxWidth }) {
        if (p) {
            const { currentValue } = p;
            this._updateStyle(0x1, 'p', p, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{padding:${to8Px(val)};}}`), new StyleCollection()));
        }
        if (pf) {
            const { currentValue } = pf;
            this._updateStyle(0x2, 'pf', pf, ({ after }) => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{padding-${after}:${to8Px(val)};}}`), new StyleCollection()));
        }
        if (pe) {
            const { currentValue } = pe;
            this._updateStyle(0x3, 'pe', pe, ({ before }) => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{padding-${before}:${to8Px(val)};}}`), new StyleCollection()));
        }
        if (pt) {
            const { currentValue } = pt;
            this._updateStyle(0x4, 'pt', pt, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{padding-top:${to8Px(val)};}}`), new StyleCollection()));
        }
        if (pb) {
            const { currentValue } = pb;
            this._updateStyle(0x5, 'pb', pb, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{padding-bottom:${to8Px(val)};}}`), new StyleCollection()));
        }
        if (px) {
            const { currentValue } = px;
            this._updateStyle(0x6, 'px', px, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{padding:0 ${typeof val === 'number'
                ? val * 8 + 'px'
                : val};}}`), new StyleCollection()));
        }
        if (py) {
            const { currentValue } = py;
            this._updateStyle(0x7, 'py', py, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{padding:${typeof val === 'number'
                ? val * 8 + 'px'
                : val} 0;}}`), new StyleCollection()));
        }
        if (m) {
            const { currentValue } = m;
            this._updateStyle(0x8, 'm', m, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{margin:${to8Px(val)};}}`), new StyleCollection()));
        }
        if (mf) {
            const { currentValue } = mf;
            this._updateStyle(0x9, 'mf', mf, ({ after }) => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{margin-${after}:${to8Px(val)};}}`), new StyleCollection()));
        }
        if (me) {
            const { currentValue } = me;
            this._updateStyle(0x10, 'me', me, ({ before }) => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{margin-${before}:${to8Px(val)};}}`), new StyleCollection()));
        }
        if (mt) {
            const { currentValue } = mt;
            this._updateStyle(0x11, 'mt', mt, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{margin-top:${to8Px(val)};}}`), new StyleCollection()));
        }
        if (mb) {
            const { currentValue } = mb;
            this._updateStyle(0x12, 'mb', mb, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{margin-bottom:${to8Px(val)};}}`), new StyleCollection()));
        }
        if (mx) {
            const { currentValue } = mx;
            this._updateStyle(0x13, 'mx', mx, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{margin:0 ${to8Px(val)};}}`), new StyleCollection()));
        }
        if (my) {
            const { currentValue } = my;
            this._updateStyle(0x14, 'my', my, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{margin:${to8Px(val)} 0;}}`), new StyleCollection()));
        }
        if (display) {
            const { currentValue } = display;
            this._updateStyle(0x15, 'display', display, () => eachMedia(currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{display:${val};}}`), new StyleCollection()));
        }
        this._updateStyle(0x16, 'width', width, () => eachMedia(width.currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{width:${transform(val)};}}`), new StyleCollection()));
        this._updateStyle(0x17, 'maxWidth', maxWidth, () => eachMedia(maxWidth.currentValue, (val, media) => ((className) => `@media ${media || 'all'}{${className}{max-width:${transform(val)};}}`), new StyleCollection()));
    }
};
/** @docs-private */
LyStyle.и = 'LyStyle';
LyStyle.ctorParameters = () => [
    { type: StyleRenderer },
    { type: LyHostClass }
];
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "p", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "pf", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "pe", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "pt", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "pb", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "px", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "py", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "m", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "mf", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "me", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "mt", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "mb", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "mx", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "my", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "display", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "width", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "maxWidth", void 0);
tslib_1.__decorate([
    Input()
], LyStyle.prototype, "lyStyle", null);
LyStyle = LyStyle_1 = tslib_1.__decorate([
    Directive({
        selector: `[lyStyle],
              [p], [pf], [pe], [pt], [pb], [px], [py],
              [m], [mf], [me], [mt], [mb], [mx], [my],
              [display],
              [maxWidth],
              [width]`,
        providers: [
            LyHostClass,
            StyleRenderer
        ]
    })
], LyStyle);
export { LyStyle };
/**
 * Convert to px if the value is a number, otherwise leave it as is
 * @docs-private
 */
function to8Px(val) {
    return typeof val === 'number'
        ? `${val * 8}px`
        : val;
}
function transform(value) {
    return value <= 1
        ? `${value * 100}%`
        : value;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3R5bGUuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGFseWxlL3VpLyIsInNvdXJjZXMiOlsic3JjL3RoZW1lL3N0eWxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFpQixZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUUsT0FBTyxFQUNMLGVBQWUsRUFDQSxNQUFNLFVBQVUsQ0FBQztBQUNsQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3BELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUcxRCxNQUFNLGNBQWMsR0FBRyxDQUFDLEdBQUcsQ0FBQztBQWM1QixJQUFhLE9BQU8sZUFBcEIsTUFBYSxPQUFPO0lBMENsQixZQUNVLEdBQWtCLEVBQ2xCLE9BQW9CO1FBRHBCLFFBQUcsR0FBSCxHQUFHLENBQWU7UUFDbEIsWUFBTyxHQUFQLE9BQU8sQ0FBYTtJQUMxQixDQUFDO0lBdEJMLElBQUksT0FBTztRQUNULE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN2QixDQUFDO0lBQ0QsSUFBSSxPQUFPLENBQUMsR0FBbUU7UUFDN0UsSUFBSSxPQUFPLEdBQUcsS0FBSyxVQUFVLEVBQUU7WUFDN0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDbkI7YUFBTTtZQUNMLElBQUksQ0FBQyxZQUFZLENBQ2YsR0FBRyxFQUNILE9BQU8sRUFDUCxHQUFHLEVBQ0gsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLEdBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQ2xDLENBQUMsU0FBaUIsRUFBRSxFQUFFLENBQUMsVUFBVSxLQUFLLElBQUksS0FBSyxJQUFJLFNBQVMs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SUFBSTtRQUNoQixDQUFDLENBQUMsR0FBRyxDQUFDO0FBQ1YsQ0FBQztBQUVELFNBQVMsU0FBUyxDQUFDLEtBQXNCO0lBQ3ZDLE9BQU8sS0FBSyxJQUFJLENBQUM7UUFDZixDQUFDLENBQUMsR0FBRyxLQUFlLEdBQUcsR0FBRyxHQUFHO1FBQzdCLENBQUMsQ0FBQyxLQUFLLENBQUM7QUFDWixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBJbnB1dCwgU2ltcGxlQ2hhbmdlcywgU2ltcGxlQ2hhbmdlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBTdHlsZUNvbGxlY3Rpb24sXG4gIFN0eWxlVGVtcGxhdGUgfSBmcm9tICcuLi9wYXJzZSc7XG5pbXBvcnQgeyBlYWNoTWVkaWEgfSBmcm9tICcuLi9zdHlsZS11dGlscyc7XG5pbXBvcnQgeyBMeUhvc3RDbGFzcyB9IGZyb20gJy4uL21pbmltYWwvaG9zdC1jbGFzcyc7XG5pbXBvcnQgeyBTdHlsZVJlbmRlcmVyIH0gZnJvbSAnLi4vbWluaW1hbC9yZW5kZXJlci1zdHlsZSc7XG5pbXBvcnQgeyBUaGVtZVJlZiB9IGZyb20gJy4vdGhlbWUyLnNlcnZpY2UnO1xuXG5jb25zdCBTVFlMRV9QUklPUklUWSA9IC0wLjU7XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogYFtseVN0eWxlXSxcbiAgICAgICAgICAgICAgW3BdLCBbcGZdLCBbcGVdLCBbcHRdLCBbcGJdLCBbcHhdLCBbcHldLFxuICAgICAgICAgICAgICBbbV0sIFttZl0sIFttZV0sIFttdF0sIFttYl0sIFtteF0sIFtteV0sXG4gICAgICAgICAgICAgIFtkaXNwbGF5XSxcbiAgICAgICAgICAgICAgW21heFdpZHRoXSxcbiAgICAgICAgICAgICAgW3dpZHRoXWAsXG4gIHByb3ZpZGVyczogW1xuICAgIEx5SG9zdENsYXNzLFxuICAgIFN0eWxlUmVuZGVyZXJcbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBMeVN0eWxlIHtcbiAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgc3RhdGljIHJlYWRvbmx5INC4ID0gJ0x5U3R5bGUnO1xuXG4gIEBJbnB1dCgpIHA6ICBzdHJpbmcgfCBudW1iZXIgfCBudWxsO1xuICBASW5wdXQoKSBwZjogc3RyaW5nIHwgbnVtYmVyIHwgbnVsbDtcbiAgQElucHV0KCkgcGU6IHN0cmluZyB8IG51bWJlciB8IG51bGw7XG4gIEBJbnB1dCgpIHB0OiBzdHJpbmcgfCBudW1iZXIgfCBudWxsO1xuICBASW5wdXQoKSBwYjogc3RyaW5nIHwgbnVtYmVyIHwgbnVsbDtcbiAgQElucHV0KCkgcHg6IHN0cmluZyB8IG51bWJlciB8IG51bGw7XG4gIEBJbnB1dCgpIHB5OiBzdHJpbmcgfCBudW1iZXIgfCBudWxsO1xuICBASW5wdXQoKSBtOiAgc3RyaW5nIHwgbnVtYmVyIHwgbnVsbDtcbiAgQElucHV0KCkgbWY6IHN0cmluZyB8IG51bWJlciB8IG51bGw7XG4gIEBJbnB1dCgpIG1lOiBzdHJpbmcgfCBudW1iZXIgfCBudWxsO1xuICBASW5wdXQoKSBtdDogc3RyaW5nIHwgbnVtYmVyIHwgbnVsbDtcbiAgQElucHV0KCkgbWI6IHN0cmluZyB8IG51bWJlciB8IG51bGw7XG4gIEBJbnB1dCgpIG14OiBzdHJpbmcgfCBudW1iZXIgfCBudWxsO1xuICBASW5wdXQoKSBteTogc3RyaW5nIHwgbnVtYmVyIHwgbnVsbDtcbiAgQElucHV0KCkgZGlzcGxheTogc3RyaW5nIHwgbnVsbDtcbiAgQElucHV0KCkgd2lkdGg6IHN0cmluZyB8IG51bWJlciB8IG51bGw7XG4gIEBJbnB1dCgpIG1heFdpZHRoOiBzdHJpbmcgfCBudW1iZXIgfCBudWxsO1xuXG4gIEBJbnB1dCgpXG4gIGdldCBseVN0eWxlKCkge1xuICAgIHJldHVybiB0aGlzLl9seVN0eWxlO1xuICB9XG4gIHNldCBseVN0eWxlKHZhbDogc3RyaW5nIHwgKCh0aGVtZTogYW55LCByZWY6IFRoZW1lUmVmKSA9PiBTdHlsZVRlbXBsYXRlKSB8IG51bGwpIHtcbiAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhpcy5fc3IuYWRkKHZhbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3VwZGF0ZVN0eWxlKFxuICAgICAgICAweGEsXG4gICAgICAgICdzdHlsZScsXG4gICAgICAgIHZhbCxcbiAgICAgICAgKCkgPT4gZWFjaE1lZGlhKHZhbCEsICh2LCBtZWRpYSkgPT4gKFxuICAgICAgICAgIChjbGFzc05hbWU6IHN0cmluZykgPT4gYEBtZWRpYSAke21lZGlhIHx8ICdhbGwnfXske2NsYXNzTmFtZX17JHt2fTt9fWBcbiAgICAgICAgKSwgbmV3IFN0eWxlQ29sbGVjdGlvbigpKVxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgcHJpdmF0ZSBfbHlTdHlsZTogc3RyaW5nIHwgbnVsbDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIF9zcjogU3R5bGVSZW5kZXJlcixcbiAgICBwcml2YXRlIF9oQ2xhc3M6IEx5SG9zdENsYXNzXG4gICkgeyB9XG5cbiAgcHJpdmF0ZSBfdXBkYXRlU3R5bGUoXG4gICAgaW5kZXg6IG51bWJlcixcbiAgICBzdHlsZUlkOiBzdHJpbmcsXG4gICAgc2ltcGxlQ2hhbmdlOiBTaW1wbGVDaGFuZ2UgfCBzdHJpbmcgfCBudW1iZXIgfCBudWxsLFxuICAgIHN0eWxlOiAodGhlbWU6IGFueSwgcmVmOiBUaGVtZVJlZikgPT4gU3R5bGVUZW1wbGF0ZVxuICApIHtcbiAgICBpZiAoc2ltcGxlQ2hhbmdlKSB7XG4gICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSBzaW1wbGVDaGFuZ2UgaW5zdGFuY2VvZiBTaW1wbGVDaGFuZ2VcbiAgICAgICAgPyBzaW1wbGVDaGFuZ2UuY3VycmVudFZhbHVlXG4gICAgICAgIDogc2ltcGxlQ2hhbmdlO1xuICAgICAgaWYgKGN1cnJlbnRWYWx1ZSAhPSBudWxsKSB7XG4gICAgICAgIHRoaXNbaW5kZXhdID0gdGhpcy5fc3IuYWRkKFxuICAgICAgICAgIGAke0x5U3R5bGUu0Lh9LS0ke3N0eWxlSWR9LSR7Y3VycmVudFZhbHVlfWAsXG4gICAgICAgICAgc3R5bGUsXG4gICAgICAgICAgU1RZTEVfUFJJT1JJVFksIHRoaXNbaW5kZXhdXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9oQ2xhc3MucmVtb3ZlKHRoaXNbaW5kZXhdKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBuZ09uQ2hhbmdlcyh7cCxcbiAgICBwZixcbiAgICBwZSxcbiAgICBwdCxcbiAgICBwYixcbiAgICBweCxcbiAgICBweSxcbiAgICBtLFxuICAgIG1mLFxuICAgIG1lLFxuICAgIG10LFxuICAgIG1iLFxuICAgIG14LFxuICAgIG15LFxuICAgIGRpc3BsYXksXG4gICAgd2lkdGgsXG4gICAgbWF4V2lkdGhcbiAgfTogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmIChwKSB7XG4gICAgICBjb25zdCB7IGN1cnJlbnRWYWx1ZSB9ID0gcDtcbiAgICAgIHRoaXMuX3VwZGF0ZVN0eWxlKFxuICAgICAgICAweDEsXG4gICAgICAgICdwJyxcbiAgICAgICAgcCxcbiAgICAgICAgKCkgPT4gZWFjaE1lZGlhKGN1cnJlbnRWYWx1ZSwgKHZhbCwgbWVkaWEpID0+IChcbiAgICAgICAgICAoY2xhc3NOYW1lOiBzdHJpbmcpID0+IGBAbWVkaWEgJHttZWRpYSB8fCAnYWxsJ317JHtjbGFzc05hbWV9e3BhZGRpbmc6JHt0bzhQeCh2YWwpfTt9fWBcbiAgICAgICAgKSwgbmV3IFN0eWxlQ29sbGVjdGlvbigpKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAocGYpIHtcbiAgICAgIGNvbnN0IHsgY3VycmVudFZhbHVlIH0gPSBwZjtcbiAgICAgIHRoaXMuX3VwZGF0ZVN0eWxlKFxuICAgICAgICAweDIsXG4gICAgICAgICdwZicsXG4gICAgICAgIHBmLFxuICAgICAgICAoe2FmdGVyfSkgPT4gZWFjaE1lZGlhKGN1cnJlbnRWYWx1ZSwgKHZhbCwgbWVkaWEpID0+IChcbiAgICAgICAgICAoY2xhc3NOYW1lOiBzdHJpbmcpID0+IGBAbWVkaWEgJHttZWRpYSB8fCAnYWxsJ317JHtjbGFzc05hbWV9e3BhZGRpbmctJHthZnRlcn06JHt0bzhQeCh2YWwpfTt9fWBcbiAgICAgICAgKSwgbmV3IFN0eWxlQ29sbGVjdGlvbigpKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAocGUpIHtcbiAgICAgIGNvbnN0IHsgY3VycmVudFZhbHVlIH0gPSBwZTtcbiAgICAgIHRoaXMuX3VwZGF0ZVN0eWxlKFxuICAgICAgICAweDMsXG4gICAgICAgICdwZScsXG4gICAgICAgIHBlLFxuICAgICAgICAoe2JlZm9yZX0pID0+IGVhY2hNZWRpYShjdXJyZW50VmFsdWUsICh2YWwsIG1lZGlhKSA9PiAoXG4gICAgICAgICAgKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBgQG1lZGlhICR7bWVkaWEgfHwgJ2FsbCd9eyR7Y2xhc3NOYW1lfXtwYWRkaW5nLSR7YmVmb3JlfToke3RvOFB4KHZhbCl9O319YFxuICAgICAgICApLCBuZXcgU3R5bGVDb2xsZWN0aW9uKCkpXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChwdCkge1xuICAgICAgY29uc3QgeyBjdXJyZW50VmFsdWUgfSA9IHB0O1xuICAgICAgdGhpcy5fdXBkYXRlU3R5bGUoXG4gICAgICAgIDB4NCxcbiAgICAgICAgJ3B0JyxcbiAgICAgICAgcHQsXG4gICAgICAgICgpID0+IGVhY2hNZWRpYShjdXJyZW50VmFsdWUsICh2YWwsIG1lZGlhKSA9PiAoXG4gICAgICAgICAgKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBgQG1lZGlhICR7bWVkaWEgfHwgJ2FsbCd9eyR7Y2xhc3NOYW1lfXtwYWRkaW5nLXRvcDoke3RvOFB4KHZhbCl9O319YFxuICAgICAgICApLCBuZXcgU3R5bGVDb2xsZWN0aW9uKCkpXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChwYikge1xuICAgICAgY29uc3QgeyBjdXJyZW50VmFsdWUgfSA9IHBiO1xuICAgICAgdGhpcy5fdXBkYXRlU3R5bGUoXG4gICAgICAgIDB4NSxcbiAgICAgICAgJ3BiJyxcbiAgICAgICAgcGIsXG4gICAgICAgICgpID0+IGVhY2hNZWRpYShjdXJyZW50VmFsdWUsICh2YWwsIG1lZGlhKSA9PiAoXG4gICAgICAgICAgKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBgQG1lZGlhICR7bWVkaWEgfHwgJ2FsbCd9eyR7Y2xhc3NOYW1lfXtwYWRkaW5nLWJvdHRvbToke3RvOFB4KHZhbCl9O319YFxuICAgICAgICApLCBuZXcgU3R5bGVDb2xsZWN0aW9uKCkpXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChweCkge1xuICAgICAgY29uc3QgeyBjdXJyZW50VmFsdWUgfSA9IHB4O1xuICAgICAgdGhpcy5fdXBkYXRlU3R5bGUoXG4gICAgICAgIDB4NixcbiAgICAgICAgJ3B4JyxcbiAgICAgICAgcHgsXG4gICAgICAgICgpID0+IGVhY2hNZWRpYShjdXJyZW50VmFsdWUsICh2YWwsIG1lZGlhKSA9PiAoXG4gICAgICAgICAgKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBgQG1lZGlhICR7bWVkaWEgfHwgJ2FsbCd9eyR7Y2xhc3NOYW1lfXtwYWRkaW5nOjAgJHt0eXBlb2YgdmFsID09PSAnbnVtYmVyJ1xuICAgICAgICAgICAgICA/IHZhbCAqIDggKyAncHgnXG4gICAgICAgICAgICAgIDogdmFsfTt9fWBcbiAgICAgICAgKSwgbmV3IFN0eWxlQ29sbGVjdGlvbigpKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAocHkpIHtcbiAgICAgIGNvbnN0IHsgY3VycmVudFZhbHVlIH0gPSBweTtcbiAgICAgIHRoaXMuX3VwZGF0ZVN0eWxlKFxuICAgICAgICAweDcsXG4gICAgICAgICdweScsXG4gICAgICAgIHB5LFxuICAgICAgICAoKSA9PiBlYWNoTWVkaWEoY3VycmVudFZhbHVlLCAodmFsLCBtZWRpYSkgPT4gKFxuICAgICAgICAgIChjbGFzc05hbWU6IHN0cmluZykgPT4gYEBtZWRpYSAke21lZGlhIHx8ICdhbGwnfXske2NsYXNzTmFtZX17cGFkZGluZzoke3R5cGVvZiB2YWwgPT09ICdudW1iZXInXG4gICAgICAgICAgICAgID8gdmFsICogOCArICdweCdcbiAgICAgICAgICAgICAgOiB2YWx9IDA7fX1gXG4gICAgICAgICksIG5ldyBTdHlsZUNvbGxlY3Rpb24oKSlcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKG0pIHtcbiAgICAgIGNvbnN0IHsgY3VycmVudFZhbHVlIH0gPSBtO1xuICAgICAgdGhpcy5fdXBkYXRlU3R5bGUoXG4gICAgICAgIDB4OCxcbiAgICAgICAgJ20nLFxuICAgICAgICBtLFxuICAgICAgICAoKSA9PiBlYWNoTWVkaWEoY3VycmVudFZhbHVlLCAodmFsLCBtZWRpYSkgPT4gKFxuICAgICAgICAgIChjbGFzc05hbWU6IHN0cmluZykgPT4gYEBtZWRpYSAke21lZGlhIHx8ICdhbGwnfXske2NsYXNzTmFtZX17bWFyZ2luOiR7dG84UHgodmFsKX07fX1gXG4gICAgICAgICksIG5ldyBTdHlsZUNvbGxlY3Rpb24oKSlcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKG1mKSB7XG4gICAgICBjb25zdCB7IGN1cnJlbnRWYWx1ZSB9ID0gbWY7XG4gICAgICB0aGlzLl91cGRhdGVTdHlsZShcbiAgICAgICAgMHg5LFxuICAgICAgICAnbWYnLFxuICAgICAgICBtZixcbiAgICAgICAgKHthZnRlcn0pID0+IGVhY2hNZWRpYShjdXJyZW50VmFsdWUsICh2YWwsIG1lZGlhKSA9PiAoXG4gICAgICAgICAgKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBgQG1lZGlhICR7bWVkaWEgfHwgJ2FsbCd9eyR7Y2xhc3NOYW1lfXttYXJnaW4tJHthZnRlcn06JHt0bzhQeCh2YWwpfTt9fWBcbiAgICAgICAgKSwgbmV3IFN0eWxlQ29sbGVjdGlvbigpKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAobWUpIHtcbiAgICAgIGNvbnN0IHsgY3VycmVudFZhbHVlIH0gPSBtZTtcbiAgICAgIHRoaXMuX3VwZGF0ZVN0eWxlKFxuICAgICAgICAweDEwLFxuICAgICAgICAnbWUnLFxuICAgICAgICBtZSxcbiAgICAgICAgKHtiZWZvcmV9KSA9PiBlYWNoTWVkaWEoY3VycmVudFZhbHVlLCAodmFsLCBtZWRpYSkgPT4gKFxuICAgICAgICAgIChjbGFzc05hbWU6IHN0cmluZykgPT4gYEBtZWRpYSAke21lZGlhIHx8ICdhbGwnfXske2NsYXNzTmFtZX17bWFyZ2luLSR7YmVmb3JlfToke3RvOFB4KHZhbCl9O319YFxuICAgICAgICApLCBuZXcgU3R5bGVDb2xsZWN0aW9uKCkpXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChtdCkge1xuICAgICAgY29uc3QgeyBjdXJyZW50VmFsdWUgfSA9IG10O1xuICAgICAgdGhpcy5fdXBkYXRlU3R5bGUoXG4gICAgICAgIDB4MTEsXG4gICAgICAgICdtdCcsXG4gICAgICAgIG10LFxuICAgICAgICAoKSA9PiBlYWNoTWVkaWEoY3VycmVudFZhbHVlLCAodmFsLCBtZWRpYSkgPT4gKFxuICAgICAgICAgIChjbGFzc05hbWU6IHN0cmluZykgPT4gYEBtZWRpYSAke21lZGlhIHx8ICdhbGwnfXske2NsYXNzTmFtZX17bWFyZ2luLXRvcDoke3RvOFB4KHZhbCl9O319YFxuICAgICAgICApLCBuZXcgU3R5bGVDb2xsZWN0aW9uKCkpXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChtYikge1xuICAgICAgY29uc3QgeyBjdXJyZW50VmFsdWUgfSA9IG1iO1xuICAgICAgdGhpcy5fdXBkYXRlU3R5bGUoXG4gICAgICAgIDB4MTIsXG4gICAgICAgICdtYicsXG4gICAgICAgIG1iLFxuICAgICAgICAoKSA9PiBlYWNoTWVkaWEoY3VycmVudFZhbHVlLCAodmFsLCBtZWRpYSkgPT4gKFxuICAgICAgICAgIChjbGFzc05hbWU6IHN0cmluZykgPT4gYEBtZWRpYSAke21lZGlhIHx8ICdhbGwnfXske2NsYXNzTmFtZX17bWFyZ2luLWJvdHRvbToke3RvOFB4KHZhbCl9O319YFxuICAgICAgICApLCBuZXcgU3R5bGVDb2xsZWN0aW9uKCkpXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChteCkge1xuICAgICAgY29uc3QgeyBjdXJyZW50VmFsdWUgfSA9IG14O1xuICAgICAgdGhpcy5fdXBkYXRlU3R5bGUoXG4gICAgICAgIDB4MTMsXG4gICAgICAgICdteCcsXG4gICAgICAgIG14LFxuICAgICAgICAoKSA9PiBlYWNoTWVkaWEoY3VycmVudFZhbHVlLCAodmFsLCBtZWRpYSkgPT4gKFxuICAgICAgICAgIChjbGFzc05hbWU6IHN0cmluZykgPT4gYEBtZWRpYSAke21lZGlhIHx8ICdhbGwnfXske2NsYXNzTmFtZX17bWFyZ2luOjAgJHt0bzhQeCh2YWwpfTt9fWBcbiAgICAgICAgKSwgbmV3IFN0eWxlQ29sbGVjdGlvbigpKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAobXkpIHtcbiAgICAgIGNvbnN0IHsgY3VycmVudFZhbHVlIH0gPSBteTtcbiAgICAgIHRoaXMuX3VwZGF0ZVN0eWxlKFxuICAgICAgICAweDE0LFxuICAgICAgICAnbXknLFxuICAgICAgICBteSxcbiAgICAgICAgKCkgPT4gZWFjaE1lZGlhKGN1cnJlbnRWYWx1ZSwgKHZhbCwgbWVkaWEpID0+IChcbiAgICAgICAgICAoY2xhc3NOYW1lOiBzdHJpbmcpID0+IGBAbWVkaWEgJHttZWRpYSB8fCAnYWxsJ317JHtjbGFzc05hbWV9e21hcmdpbjoke3RvOFB4KHZhbCl9IDA7fX1gXG4gICAgICAgICksIG5ldyBTdHlsZUNvbGxlY3Rpb24oKSlcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGRpc3BsYXkpIHtcbiAgICAgIGNvbnN0IHsgY3VycmVudFZhbHVlIH0gPSBkaXNwbGF5O1xuICAgICAgdGhpcy5fdXBkYXRlU3R5bGUoXG4gICAgICAgIDB4MTUsXG4gICAgICAgICdkaXNwbGF5JyxcbiAgICAgICAgZGlzcGxheSxcbiAgICAgICAgKCkgPT4gZWFjaE1lZGlhKGN1cnJlbnRWYWx1ZSwgKHZhbCwgbWVkaWEpID0+IChcbiAgICAgICAgICAoY2xhc3NOYW1lOiBzdHJpbmcpID0+IGBAbWVkaWEgJHttZWRpYSB8fCAnYWxsJ317JHtjbGFzc05hbWV9e2Rpc3BsYXk6JHt2YWx9O319YFxuICAgICAgICApLCBuZXcgU3R5bGVDb2xsZWN0aW9uKCkpXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuX3VwZGF0ZVN0eWxlKFxuICAgICAgMHgxNixcbiAgICAgICd3aWR0aCcsXG4gICAgICB3aWR0aCxcbiAgICAgICgpID0+IGVhY2hNZWRpYSh3aWR0aC5jdXJyZW50VmFsdWUsICh2YWwsIG1lZGlhKSA9PiAoXG4gICAgICAgIChjbGFzc05hbWU6IHN0cmluZykgPT4gYEBtZWRpYSAke21lZGlhIHx8ICdhbGwnfXske2NsYXNzTmFtZX17d2lkdGg6JHt0cmFuc2Zvcm0odmFsKX07fX1gXG4gICAgICApLCBuZXcgU3R5bGVDb2xsZWN0aW9uKCkpXG4gICAgKTtcblxuICAgIHRoaXMuX3VwZGF0ZVN0eWxlKFxuICAgICAgMHgxNyxcbiAgICAgICdtYXhXaWR0aCcsXG4gICAgICBtYXhXaWR0aCxcbiAgICAgICgpID0+IGVhY2hNZWRpYShtYXhXaWR0aC5jdXJyZW50VmFsdWUsICh2YWwsIG1lZGlhKSA9PiAoXG4gICAgICAgIChjbGFzc05hbWU6IHN0cmluZykgPT4gYEBtZWRpYSAke21lZGlhIHx8ICdhbGwnfXske2NsYXNzTmFtZX17bWF4LXdpZHRoOiR7dHJhbnNmb3JtKHZhbCl9O319YFxuICAgICAgKSwgbmV3IFN0eWxlQ29sbGVjdGlvbigpKVxuICAgICk7XG5cbiAgfVxufVxuXG4vKipcbiAqIENvbnZlcnQgdG8gcHggaWYgdGhlIHZhbHVlIGlzIGEgbnVtYmVyLCBvdGhlcndpc2UgbGVhdmUgaXQgYXMgaXNcbiAqIEBkb2NzLXByaXZhdGVcbiAqL1xuZnVuY3Rpb24gdG84UHgodmFsOiBudW1iZXIgfCBzdHJpbmcpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdudW1iZXInXG4gICAgPyBgJHt2YWwgKiA4fXB4YFxuICAgIDogdmFsO1xufVxuXG5mdW5jdGlvbiB0cmFuc2Zvcm0odmFsdWU6IG51bWJlciB8IHN0cmluZykge1xuICByZXR1cm4gdmFsdWUgPD0gMVxuICAgID8gYCR7dmFsdWUgYXMgbnVtYmVyICogMTAwfSVgXG4gICAgOiB2YWx1ZTtcbn1cbiJdfQ==