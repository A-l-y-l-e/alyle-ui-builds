!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@alyle/ui"),require("rxjs"),require("@angular/platform-browser"),require("@angular/common")):"function"==typeof define&&define.amd?define("@alyle/ui/resizing-cropping-images",["exports","@angular/core","@alyle/ui","rxjs","@angular/platform-browser","@angular/common"],t):t(((e=e||self).ly=e.ly||{},e.ly["resizing-Cropping-Images"]={}),e.ng.core,e.ly.core,e.rxjs,e.ng.platformBrowser,e.ng.common)}(this,function(e,t,i,n,r,o){"use strict";var s=function(){return(s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function a(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s}function h(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var c,l,p=function(e){return{$priority:-2,root:{"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",userSelect:"none",display:"flex",overflow:"hidden",position:"relative",justifyContent:"center",alignItems:"center","&":e.imgCropper?e.imgCropper.root:null},imgContainer:{cursor:"move",position:"absolute",top:0,left:0,"& > canvas":{pointerEvents:"none"}},area:s({pointerEvents:"none",boxShadow:"0 0 0 20000px rgba(0, 0, 0, 0.4)"},i.LY_COMMON_STYLES.fill,{margin:"auto","&:before, &:after":s({},i.LY_COMMON_STYLES.fill,{content:"''"}),"&:before":{width:0,height:0,margin:"auto",borderRadius:"50%",background:"#fff",border:"solid 2px rgb(255, 255, 255)"},"&:after":{border:"solid 2px rgb(255, 255, 255)"}}),defaultContent:{display:"flex",alignItems:"center",justifyContent:"center","&, & > input":i.LY_COMMON_STYLES.fill,"& *:not(input)":{pointerEvents:"none"},"& > input":{background:"transparent",opacity:0,width:"100%",height:"100%"}}}},g=p;(c=e.ImgResolution||(e.ImgResolution={}))[c.Default=0]="Default",c[c.OriginalImage=1]="OriginalImage",(l=e.ImgCropperError||(e.ImgCropperError={}))[l.Size=0]="Size",l[l.Type=1]="Type",l[l.Other=2]="Other";var d={width:250,height:200,output:e.ImgResolution.Default,antiAliased:!0},m=function(){function r(e,i,n,r){this._renderer=e,this.theme=i,this.elementRef=n,this.cd=r,this.classes=this.theme.addStyleSheet(p),this._imgRect={},this._listeners=new Set,this.scaleChange=new t.EventEmitter,this.loaded=new t.EventEmitter,this.cropped=new t.EventEmitter,this.error=new t.EventEmitter,this._renderer.addClass(n.nativeElement,this.classes.root)}return Object.defineProperty(r.prototype,"config",{get:function(){return this._config},set:function(e){this._config=i.mergeDeep({},d,e);var t=this._config.maxFileSize;t&&(this.maxFileSize=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale",{get:function(){return this._scale},set:function(e){this.setScale(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minScale",{get:function(){return this._minScale},enumerable:!0,configurable:!0}),r.prototype.ngOnDestroy=function(){this._listeners.forEach(function(e){return e.unsubscribe()}),this._listeners.clear()},r.prototype._imgLoaded=function(e){if(e){this._img=e;var t=this._imgCanvas.nativeElement;t.width=e.width,t.height=e.height;var i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0),this._updateMinScale(t)}},r.prototype._setStylesForContImg=function(e){var t={},i=this._rootRect();if(void 0!==e.x&&void 0!==e.y){var n=i.width/2-e.x,r=i.height/2-e.y;this._imgRect.x=e.x,this._imgRect.y=e.y,this._imgRect.xc=n,this._imgRect.yc=r}for(var o in t.transform="translate3d("+this._imgRect.x+"px,"+this._imgRect.y+"px, 0)",t.transform+="scale("+this._scal3Fix+")",t.transformOrigin=this._imgRect.xc+"px "+this._imgRect.yc+"px 0",t)t.hasOwnProperty(o)&&this._renderer.setStyle(this._imgContainer.nativeElement,o,t[o])},r.prototype._resize$=function(){this.isLoaded&&this.updatePosition()},r.prototype.selectInputEvent=function(t){var i=this,r=t.target;if(!r.files||1===r.files.length){var o=r.files[0].size,s=r.value.replace(/.*(\/|\\)/,"");if(this.maxFileSize&&o>this.maxFileSize){var a={name:s,type:r.files[0].type,size:o,error:e.ImgCropperError.Size};return this.clean(),void this.error.emit(a)}var h=new n.Observable(function(e){var t=new FileReader;return t.onerror=function(t){return e.error(t)},t.onabort=function(t){return e.error(t)},t.onload=function(t){return setTimeout(function(){e.next(t),e.complete()},1)},t.readAsDataURL(r.files[0])}).subscribe({next:function(e){var t=e.target.result;i.config.type||(i._defaultType=r.files[0].type),i._fileName=s,i._sizeInBytes=r.files[0].size,i.setImageUrl(t),i.cd.markForCheck(),i._listeners["delete"](h)},error:function(){var t={name:s,size:o,error:e.ImgCropperError.Other,errorMsg:"The File could not be loaded."};i.clean(),i.error.emit(t),i._listeners["delete"](h),i.ngOnDestroy()}});this._listeners.add(h)}},r.prototype.setScale=function(e,t){var i=e>=this.minScale&&e<=1?e:this.minScale,n=null!=e&&e!==this.scale&&i!==this.scale;if(this._scale=e,n){if(this._scal3Fix=i,this.isLoaded){if(!n)return;var r=s({},this._imgRect);this.offset={x:r.x,y:r.y,left:r.xc,top:r.yc},this._setStylesForContImg({}),this._move({srcEvent:{},deltaX:0,deltaY:0})}else{if(!this.minScale)return;this._setStylesForContImg(s({},this._getCenterPoints()))}this.scaleChange.emit(e),t||this._cropIfAutoCrop()}},r.prototype._getCenterPoints=function(){var e=this.elementRef.nativeElement,t=this._imgCanvas.nativeElement;return{x:(e.offsetWidth-t.width)/2,y:(e.offsetHeight-t.height)/2}},r.prototype.fitToScreen=function(){var e=this.elementRef.nativeElement,t=e.offsetWidth,i=e.offsetHeight,n=this._img,r={width:t/n.width,height:i/n.height},o=Math.max(r.width,r.height);this.setScale(o)},r.prototype.fit=function(){this.setScale(this.minScale)},r.prototype._moveStart=function(){this.offset={x:this._imgRect.x,y:this._imgRect.y,left:this._imgRect.xc,top:this._imgRect.yc}},r.prototype._move=function(e){var t,i,n=this._imgCanvas.nativeElement,r=this._scal3Fix,o=this.config,s=this.offset;if(r&&s){var a=n.height*r<o.height&&o.extraZoomOut,h=n.width*r<o.width&&o.extraZoomOut,c=o.width/2/r>=s.left-e.deltaX/r,l=o.width/2/r+n.width-(s.left-e.deltaX/r)<=o.width/r,p=o.height/2/r>=s.top-e.deltaY/r,g=o.height/2/r+n.height-(s.top-e.deltaY/r)<=o.height/r;(c&&!h||!c&&h)&&(t=s.x+s.left-o.width/2/r),(l&&!h||!l&&h)&&(t=s.x+s.left+o.width/2/r-n.width),(p&&!a||!p&&a)&&(i=s.y+s.top-o.height/2/r),(g&&!a||!g&&a)&&(i=s.y+s.top+o.height/2/r-n.height),void 0===t&&(t=e.deltaX/r+s.x),void 0===i&&(i=e.deltaY/r+s.y),this._setStylesForContImg({x:t,y:i})}},r.prototype.updatePosition=function(e,t){var i=this._rootRect(),n=this._areaCropperRect();e===undefined&&t===undefined&&(e=this._imgRect.xc,t=this._imgRect.yc),e=n.x-i.x-(e-this.config.width/2),t=n.y-i.y-(t-this.config.height/2),this._setStylesForContImg({x:e,y:t})},r.prototype._slideEnd=function(){this._cropIfAutoCrop()},r.prototype._cropIfAutoCrop=function(){this.config.autoCrop&&this.crop()},r.prototype.zoomIn=function(){var e=this._scal3Fix+.05;e>0&&e<=1?this.setScale(e):this.setScale(1)},r.prototype.clean=function(){if(this.isLoaded){this._imgRect={},this.offset=undefined,this.scale=undefined,this._scal3Fix=undefined,this._rotation=0,this._minScale=undefined,this._isLoadedImg=!1,this.isLoaded=!1,this.isCropped=!1,this._originalImgBase64=undefined;var e=this._imgCanvas.nativeElement;e.width=0,e.height=0,this.cd.markForCheck()}},r.prototype.zoomOut=function(){var e=this._scal3Fix-.05;e>this.minScale&&e<=1?this.setScale(e):this.fit()},r.prototype.center=function(){var e=s({},this._getCenterPoints());this._setStylesForContImg(e),this._cropIfAutoCrop()},r.prototype.setImageUrl=function(t,i){var r=this;this.clean(),this._originalImgBase64=t;var o=new Image,s=this._sizeInBytes,a=this._fileName,h=this._defaultType;o.crossOrigin="anonymous";var c={name:a,type:h,originalDataURL:t};o.src=t,s&&(c.size=s);var l=new n.Observable(function(e){o.onerror=function(t){return e.error(t)},o.onabort=function(t){return e.error(t)},o.onload=function(){return setTimeout(function(){e.next(null),e.complete()},0)}}).subscribe({next:function(){r._imgLoaded(o),c.width=o.width,c.height=o.height,r._isLoadedImg=!0,r.cd.markForCheck(),r.cd.detectChanges(),Promise.resolve(null).then(function(){r._updateMinScale(r._imgCanvas.nativeElement),r.isLoaded=!1,i?i():r.setScale(r.minScale,!0),r.loaded.emit(c),r.isLoaded=!0,r._cropIfAutoCrop(),r.cd.markForCheck()}),r._listeners["delete"](l),r.ngOnDestroy()},error:function(){c.error=e.ImgCropperError.Type,r.error.emit(c),r._listeners["delete"](l),r.ngOnDestroy()}});this._listeners.add(l),this._sizeInBytes=null,this._fileName=null,this._defaultType=undefined},r.prototype.rotate=function(e){var t,i,n,r,o,a,h,c=this._rotation=(i=u(t=e,360),n=u(i.result,90),r=Math.sign(t),n.result>=45?90*(n.parts+1)*r:90*n.parts*r),l=c*Math.PI/180,p=this._imgCanvas.nativeElement,g=(o=p,a=document.createElement("canvas"),h=a.getContext("2d"),a.width=o.width,a.height=o.height,h.drawImage(o,0,0),a),d=p.getContext("2d");d.clearRect(0,0,g.width,g.height),this._renderer.setStyle(p,"transform","rotate("+c+"deg) scale("+1/this._scal3Fix+")"),this._renderer.setStyle(p,"transformOrigin",this._imgRect.xc+"px "+this._imgRect.yc+"px 0");var m=p.getBoundingClientRect(),f=m.x,y=m.y,_=p.getBoundingClientRect();this._renderer.removeStyle(p,"transform"),this._renderer.removeStyle(p,"transformOrigin");var v=_.width,C=_.height;d.canvas.width=v,d.canvas.height=C,d.clearRect(0,0,v,C),d.translate(v/2,C/2),d.rotate(l),d.drawImage(g,-g.width/2,-g.height/2),this._updateMinScale(p),this.scale<this.minScale&&this.setScale(0,!0);var x=this._rootRect();this._setStylesForContImg({x:f-x.x,y:y-x.y});var w=s({},this._imgRect);this.offset={x:w.x,y:w.y,left:w.xc,top:w.yc},this._setStylesForContImg({}),this._move({srcEvent:{},deltaX:0,deltaY:0}),this._cropIfAutoCrop()},r.prototype._updateMinScale=function(e){var t=this.config;this._minScale=(t.extraZoomOut?Math.min:Math.max)(t.width/e.width,t.height/e.height)},r.prototype.imageSmoothingQuality=function(e,t,i){var n=Math.ceil(Math.log(Math.max(e.width,e.height)/Math.max(t.width,t.height))/Math.log(2))-1;n=n<=0?0:n;var r=Array.from(Array(n).keys()),o=e.getContext("2d"),s=Math.pow(10*i,n)/Math.pow(10,n),a=this._defaultType;if(n){var h=e.width*i,c=e.height*i;"image/png"!==a&&"image/svg+xml"!==a||(o.globalCompositeOperation="copy"),r.forEach(function(){o.drawImage(e,0,0,h,c)})}var l=document.createElement("canvas"),p=l.getContext("2d");return l.width=t.width,l.height=t.height,p.drawImage(e,0,0,e.width*s,e.height*s,0,0,l.width,l.height),l},r.prototype.crop=function(e){var t=e?i.mergeDeep({},this.config||d,e):this.config,n=this._imgCrop(t);return this.cd.markForCheck(),n},r.prototype._imgCrop=function(e){var t=document.createElement("canvas"),i=this._imgRect,n=this._scal3Fix,r=i.xc-e.width/2/n,o=i.yc-e.height/2/n,s={width:e.width,height:e.height};t.width=s.width/n,t.height=s.height/n;var a=t.getContext("2d");e.fill&&(a.fillStyle=e.fill,a.fillRect(0,0,t.width,t.height)),a.drawImage(this._imgCanvas.nativeElement,-r,-o);var h=t,c=e.antiAliased?.5:1;0===e.output?h=this.imageSmoothingQuality(h,s,c):"object"==typeof e.output&&(h=this.imageSmoothingQuality(h,e.output,c));var l={dataURL:e.type?h.toDataURL(""+e.type):h.toDataURL(this._defaultType),type:this._defaultType||e.type,name:this._fileName,width:s.width,height:s.height,originalDataURL:this._originalImgBase64,scale:this._scal3Fix,rotation:this._rotation,position:{x:this._imgRect.xc,y:this._imgRect.yc}};return this.isCropped=!0,this.cropped.emit(l),l},r.prototype._rootRect=function(){return this.elementRef.nativeElement.getBoundingClientRect()},r.prototype._areaCropperRect=function(){return this._croppingContainer.nativeElement.getBoundingClientRect()},a([t.ViewChild("_imgContainer",{"static":!0}),h("design:type",t.ElementRef)],r.prototype,"_imgContainer",void 0),a([t.ViewChild("_croppingContainer",{"static":!1}),h("design:type",t.ElementRef)],r.prototype,"_croppingContainer",void 0),a([t.ViewChild("_imgCanvas",{"static":!0}),h("design:type",t.ElementRef)],r.prototype,"_imgCanvas",void 0),a([t.Input(),h("design:type",Object),h("design:paramtypes",[Object])],r.prototype,"config",null),a([t.Input(),h("design:type",Number),h("design:paramtypes",[Number])],r.prototype,"scale",null),a([t.Input(),h("design:type",Number)],r.prototype,"maxFileSize",void 0),a([t.Output(),h("design:type",Object)],r.prototype,"scaleChange",void 0),a([t.Output(),h("design:type",Object)],r.prototype,"loaded",void 0),a([t.Output(),h("design:type",Object)],r.prototype,"cropped",void 0),a([t.Output(),h("design:type",Object)],r.prototype,"error",void 0),a([t.HostListener("window:resize"),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],r.prototype,"_resize$",null),r=a([t.Component({changeDetection:t.ChangeDetectionStrategy.OnPush,preserveWhitespaces:!1,selector:"ly-img-cropper, ly-cropping",template:'<div #_imgContainer\n[className]="classes.imgContainer"\n(slidestart)="_moveStart()"\n(slide)="_move($event)"\n(slideend)="_slideEnd()">\n  <canvas #_imgCanvas></canvas>\n</div>\n<div #_croppingContainer *ngIf="_isLoadedImg; else content" [className]="classes.area" [ngStyle]="{\n  width: config.width + \'px\',\n  height: config.height + \'px\'\n}"></div>\n<ng-template #content>\n  <div [className]="classes.defaultContent">\n    <input #_fileInput type="file" (change)="selectInputEvent($event)" accept="image/*">\n    <ng-content></ng-content>\n  </div>\n</ng-template>\n'}),h("design:paramtypes",[t.Renderer2,i.LyTheme2,t.ElementRef,t.ChangeDetectorRef])],r)}();function u(e,t){var i,n=Math.abs(e),r=Math.floor(n/t);return i=r?n-t*r:e,n!==e&&(i*=-1),{result:i,parts:r}}var f=function(){function e(){}return e=a([t.NgModule({imports:[o.CommonModule],exports:[m],providers:[{provide:r.HAMMER_GESTURE_CONFIG,useClass:i.LyHammerGestureConfig}],declarations:[m]})],e)}();e.LyResizingCroppingImageModule=f,e.LyResizingCroppingImages=m,e.ɵ0=g,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=alyle-ui-resizing-cropping-images.umd.min.js.map