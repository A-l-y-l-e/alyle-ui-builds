!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("@alyle/ui"),require("@angular/platform-browser"),require("@angular/common")):"function"==typeof define&&define.amd?define("@alyle/ui/resizing-cropping-images",["exports","@angular/core","rxjs","@alyle/ui","@angular/platform-browser","@angular/common"],e):e((t.alyle=t.alyle||{},t.alyle.ui=t.alyle.ui||{},t.alyle.ui["resizing-cropping-images"]={}),t.ng.core,t.rxjs,t.alyle.ui,t.ng.platformBrowser,t.ng.common)}(this,function(t,r,a,e,i,n){"use strict";function o(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(n=r.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(o)throw o.error}}return a}var s={root:{"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",userSelect:"none",display:"flex",overflow:"hidden",position:"relative",justifyContent:"center",alignItems:"center"},imgContainer:{cursor:"move",position:"absolute",top:0,left:0,"& > img":{width:"100%",height:"100%",pointerEvents:"none"}},croppingContainer:{position:"absolute",pointerEvents:"none",boxShadow:"0 0 0 20000px rgba(0, 0, 0, 0.29)","&::after":{content:"''",position:"absolute",top:0,left:0,right:0,bottom:0,border:"solid 2px rgb(255, 255, 255)"}},croppContent:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:0,left:0,right:0,bottom:0,"& *:not(input)":{pointerEvents:"none"},"& > input":{position:"absolute",background:"transparent",opacity:0,top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"}}},h={Default:0,OriginalImage:1};h[h.Default]="Default",h[h.OriginalImage]="OriginalImage";var p={width:250,height:200,output:h.Default},l=function(){function t(t,e,i,n){var o=this;this._renderer=t,this.theme=e,this.elementRef=i,this.cd=n,this.classes=this.theme.addStyleSheet(s,"ly-image-cropper",-2),this.img=new a.BehaviorSubject(null),this.config=p,this.loaded=new r.EventEmitter,this.cropped=new r.EventEmitter,this.error=new r.EventEmitter,this._dragData=new a.Subject,this.zoomScale=.1,this._renderer.addClass(i.nativeElement,this.classes.root),this.dragData=this._dragData.asObservable(),this.img.subscribe(function(t){if(t){o._img=t;var e={width:o.config.width/o._img.width*100,height:o.config.height/o._img.height*100};o.zoomScale=Math.max(e.width,e.height)/100,o.fit(),o.cd.markForCheck()}})}return t.prototype.selectInputEvent=function(t){var i=this,e=t.target;if(1===e.files.length){var n=new FileReader;this.fileName=e.value.replace(/.*(\/|\\)/,""),this.defaultType=null,this.config.type||(this.defaultType=e.files[0].type),this.isLoaded=!1,this.isCropped=!1,this._dragData.next(null),n.addEventListener("loadend",function(t){var e=t.target.result;i.setImageUrl(e),i.cd.markForCheck()}),n.readAsDataURL(e.files[0])}},t.prototype.fixedNum=function(t){return parseFloat(t.toFixed(0))},t.prototype.setScale=function(t){this.scale=t,t*=100;this.imgContainer.nativeElement.firstElementChild;var e=this._img,i=this.fixedNum(e.width*t/100),n=this.fixedNum(e.height*t/100);this._dragData.next({width:i+"px",height:n+"px",transform:this.customCenter(i,n)})},t.prototype.customCenter=function(t,e){var i=this.elementRef.nativeElement;return"translate3d("+(i.offsetWidth-t)/2+"px, "+(i.offsetHeight-e)/2+"px, 0)"},t.prototype["1:1"]=function(){this.setScale(1)},t.prototype.fitToScreen=function(){var t=this.elementRef.nativeElement,e=t.offsetWidth,i=t.offsetHeight,n={width:e/this._img.width*100,height:i/this._img.height*100},o=Math.max(n.width,n.height)/100;this.setScale(o)},t.prototype.fit=function(){var t={width:this.config.width/this._img.width*100,height:this.config.height/this._img.height*100};this.setScale(Math.max(t.width,t.height)/100)},t.prototype._moveStart=function(t){var e=this.imgContainer.nativeElement.getBoundingClientRect(),i=this.elementRef.nativeElement.getBoundingClientRect();"touchstart"===t.type?(t.targetTouches[0].clientX,t.targetTouches[0].clientY):(t.center.x,t.center.y),this.offset={x:t.center.x-e.x,y:t.center.y-e.y,left:e.left-i.x,top:e.top-i.y}},t.prototype._move=function(t){var e,i,n=this.elementRef.nativeElement.getBoundingClientRect();this.imgContainer.nativeElement.getBoundingClientRect();t.srcEvent.shiftKey&&(Math.abs(t.deltaX)===Math.max(Math.abs(t.deltaX),Math.abs(t.deltaY))?i=this.offset.top:e=this.offset.left),e===undefined&&(e=t.center.x-n.x-this.offset.x),i===undefined&&(i=t.center.y-n.y-this.offset.y),this._dragData.next({width:this.imgContainer.nativeElement.offsetWidth,height:this.imgContainer.nativeElement.offsetHeight,transform:"translate3d("+e+"px, "+i+"px, 0)"})},t.prototype.roundNumber=function(t){return Math.round(1e5*t)/1e5},t.prototype.zoomIn=function(){var t=this.roundNumber(this.scale+.05);0<t&&t<=1?this.setScale(t):this.setScale(1)},t.prototype.zoomOut=function(){var t=this.roundNumber(this.scale-.05);t>this.zoomScale&&t<=1?this.setScale(t):this.fit()},t.prototype.ngAfterContentInit=function(){this.setImageUrl(this.src)},t.prototype.center=function(t){t||(t=this.imgContainer.nativeElement.firstElementChild);var e=this.elementRef.nativeElement,i=(e.offsetWidth,t.width,e.offsetHeight,t.height,{width:t.width+"px",height:t.height+"px",transform:this.customCenter(t.width,t.height)});this._dragData.next(i)},t.prototype.setImageUrl=function(t){var e=this;if(this.src=t){var i=new Image;i.src=t,i.addEventListener("error",function(t){e.error.emit(null)}),i.addEventListener("load",function(){e.img.next(i),e.loaded.emit(null),e.isLoaded=!0,e.cd.markForCheck()})}},t.prototype.max=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Math.max.apply(Math,function i(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}(t))},t.prototype.imageSmoothingQuality=function(i,t,e){var n=Math.ceil(Math.log(this.max(i.width,i.height)/this.max(t.height,t.width))/Math.log(2))-1;n=n<=0?0:n;var o=Array.from(Array(n).keys()),r=i.getContext("2d"),a=Math.pow(10*e,n)/Math.pow(10,n);if(n){var s=i.width*e,h=i.height*e;r.globalCompositeOperation="copy",o.forEach(function(t,e){r.drawImage(i,0,0,s,h)})}var l=document.createElement("canvas"),p=l.getContext("2d");return l.width=t.width,l.height=t.height,p.drawImage(i,0,0,i.width*a,i.height*a,0,0,l.width,l.height),l},t.prototype.crop=function(){return{base64Image:this.cropp(),type:this.defaultType||this.config.type}},t.prototype.cropp=function(){var t=Object.assign({},p,this.config),e=document.createElement("canvas"),i=this.croppingContainer.nativeElement.getBoundingClientRect(),n=this.imgContainer.nativeElement.firstElementChild.getBoundingClientRect(),o=i.left-n.left,r=i.top-n.top,a={width:t.width,height:t.height};this._img.width,this._img.height;e.width=a.width/this.scale,e.height=a.height/this.scale;var s=e.getContext("2d");t.fill&&(s.fillStyle=t.fill,s.fillRect(0,0,e.width,e.height)),s.drawImage(this._img,-o/this.scale,-r/this.scale);var h,l=e;return 0===t.output?l=this.imageSmoothingQuality(l,a,.5):"object"==typeof t.output&&(l=this.imageSmoothingQuality(l,t.output,.5)),h=t.type?l.toDataURL("image/"+t.type):l.toDataURL(this.defaultType),this.result=h,this.cropped.emit({base64Image:h,type:this.defaultType||t.type}),this.isCropped=!0,h},t.decorators=[{type:r.Component,args:[{changeDetection:r.ChangeDetectionStrategy.OnPush,preserveWhitespaces:!1,selector:"ly-cropping",template:'<div [className]="classes.imgContainer" #_imgContainer\n(slidestart)="_moveStart($event)"\n(slide)="_move($event)"\n[ngStyle]="dragData | async">\n  <img *ngIf="isLoaded"\n  [src]="src">\n</div>\n<div #_croppingContainer *ngIf="isLoaded; else content" [className]="classes.croppingContainer" [ngStyle]="{\n  width: config.width + \'px\',\n  height: config.height + \'px\'\n}"></div>\n<ng-template #content>\n  <div [className]="classes.croppContent">\n    <input #_fileInput type="file" (change)="selectInputEvent($event)" accept="image/*">\n    <ng-content></ng-content>\n  </div>\n</ng-template>'}]}],t.ctorParameters=function(){return[{type:r.Renderer2},{type:e.LyTheme2},{type:r.ElementRef},{type:r.ChangeDetectorRef}]},t.propDecorators={imgContainer:[{type:r.ViewChild,args:["_imgContainer"]}],croppingContainer:[{type:r.ViewChild,args:["_croppingContainer"]}],src:[{type:r.Input}],format:[{type:r.Input}],config:[{type:r.Input}],loaded:[{type:r.Output}],cropped:[{type:r.Output}],error:[{type:r.Output}]},t}(),g=function(){function t(){}return t.decorators=[{type:r.NgModule,args:[{imports:[n.CommonModule],exports:[l],providers:[{provide:i.HAMMER_GESTURE_CONFIG,useClass:e.LyHammerGestureConfig}],declarations:[l]}]}],t}();t.ImageResolution=h,t.LyResizingCroppingImages=l,t.LyResizingCroppingImageModule=g,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=alyle-ui-resizing-cropping-images.umd.min.js.map