!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@alyle/ui"),require("@angular/platform-browser"),require("@angular/common")):"function"==typeof define&&define.amd?define("@alyle/ui/resizing-cropping-images",["exports","@angular/core","@alyle/ui","@angular/platform-browser","@angular/common"],t):t((e.alyle=e.alyle||{},e.alyle.ui=e.alyle.ui||{},e.alyle.ui["resizing-cropping-images"]={}),e.ng.core,e.alyle.ui,e.ng.platformBrowser,e.ng.common)}(this,function(e,o,n,t,i){"use strict";var r=function(){return(r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function a(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=r.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(o)throw o.error}}return a}var s={root:{"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",userSelect:"none",display:"flex",overflow:"hidden",position:"relative",justifyContent:"center",alignItems:"center"},imgContainer:{cursor:"move",position:"absolute",top:0,left:0,"& > img":{width:"100%",height:"100%",pointerEvents:"none"}},croppingContainer:{position:"absolute",pointerEvents:"none",boxShadow:"0 0 0 20000px rgba(0, 0, 0, 0.4)","&:before, &:after":r({},n.LY_COMMON_STYLES.fill,{content:"''"}),"&:before":{width:0,height:0,margin:"auto",borderRadius:"50%",background:"#fff",border:"solid 2px rgb(255, 255, 255)"},"&:after":{border:"solid 2px rgb(255, 255, 255)"}},croppContent:{display:"flex",alignItems:"center",justifyContent:"center","&, & > input":n.LY_COMMON_STYLES.fill,"& *:not(input)":{pointerEvents:"none"},"& > input":{background:"transparent",opacity:0,width:"100%",height:"100%"}}},h={Default:0,OriginalImage:1};h[h.Default]="Default",h[h.OriginalImage]="OriginalImage";var l={Default:0,OriginalImage:1};l[l.Default]="Default",l[l.OriginalImage]="OriginalImage";var p={width:250,height:200,output:h.Default,antiAliased:!0},g=function(){function e(e,t,i,n){this._renderer=e,this.theme=t,this.elementRef=i,this.cd=n,this.classes=this.theme.addStyleSheet(s,-2),this.loaded=new o.EventEmitter,this.cropped=new o.EventEmitter,this.error=new o.EventEmitter,this._renderer.addClass(i.nativeElement,this.classes.root)}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},set:function(e){this._config=n.mergeDeep({},p,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minScale",{get:function(){return this._minScale},enumerable:!0,configurable:!0}),e.prototype._imgLoaded=function(e){if(e){this._img=e;var t={width:this.config.width/this._img.width*100,height:this.config.height/this._img.height*100};this._minScale=Math.max(t.width,t.height)/100,this.fit(),this.cd.markForCheck()}},e.prototype._setStylesForContImg=function(e){for(var t in e)e.hasOwnProperty(t)&&this._renderer.setStyle(this.imgContainer.nativeElement,t,e[t])},e.prototype.selectInputEvent=function(e){var i=this,t=e.target;if(1===t.files.length){var n=new FileReader;this._fileName=t.value.replace(/.*(\/|\\)/,""),this.defaultType=null,this.config.type||(this.defaultType=t.files[0].type),this.isLoaded=!1,this.isCropped=!1,n.addEventListener("loadend",function(e){var t=e.target.result;i.setImageUrl(t),i.cd.markForCheck()}),n.readAsDataURL(t.files[0])}},e.prototype.setScale=function(e){e=e>this.minScale&&e<=1?e:this.minScale,this._scale=e,e*=100;var t=this._img,i=c(t.width*e/100),n=c(t.height*e/100),o=this.elementRef.nativeElement.getBoundingClientRect();if(this.isLoaded){var r=this.imgContainer.nativeElement.getBoundingClientRect();this.offset={x:o.width/2-(r.x-o.x),y:o.height/2-(r.y-o.y),left:r.left-o.x,top:r.top-o.y},this._setStylesForContImg({width:i+"px",height:n+"px"}),this._move({srcEvent:{},center:{x:o.width/2-this.offset.x*(i/r.width)+o.x+this.offset.x,y:o.height/2-this.offset.y*(n/r.height)+o.y+this.offset.y}})}else this._setStylesForContImg({width:i+"px",height:n+"px",transform:this.customCenter(i,n)})},e.prototype.customCenter=function(e,t){var i=this.elementRef.nativeElement;return"translate3d("+(i.offsetWidth-e)/2+"px, "+(i.offsetHeight-t)/2+"px, 0)"},e.prototype["1:1"]=function(){this.setScale(1)},e.prototype.fitToScreen=function(){var e=this.elementRef.nativeElement,t=e.offsetWidth,i=e.offsetHeight,n={width:t/this._img.width*100,height:i/this._img.height*100},o=Math.max(n.width,n.height)/100;this.setScale(o)},e.prototype.fit=function(){this.setScale(0)},e.prototype._moveStart=function(e){var t=this.elementRef.nativeElement.getBoundingClientRect(),i=this.imgContainer.nativeElement.getBoundingClientRect();this.offset={x:e.center.x-i.x,y:e.center.y-i.y,left:i.left-t.x,top:i.top-t.y}},e.prototype._move=function(e){var t,i,n=this.elementRef.nativeElement.getBoundingClientRect(),o=this.imgContainer.nativeElement.getBoundingClientRect(),r=this.croppingContainer.nativeElement.getBoundingClientRect();e.center.x-this.offset.x>=r.x&&(t=r.x-n.x),e.center.y-this.offset.y>=r.y&&(i=r.y-n.y),e.center.x-this.offset.x+o.width<=r.x+r.width&&(t=r.x-n.x-o.width+r.width),e.center.y-this.offset.y+o.height<=r.y+r.height&&(i=r.y-n.y-o.height+r.height),e.srcEvent.shiftKey&&(Math.abs(e.deltaX)===Math.max(Math.abs(e.deltaX),Math.abs(e.deltaY))?i=this.offset.top:t=this.offset.left),t===undefined&&(t=e.center.x-n.x-this.offset.x),i===undefined&&(i=e.center.y-n.y-this.offset.y),this._setStylesForContImg({width:this.imgContainer.nativeElement.offsetWidth,height:this.imgContainer.nativeElement.offsetHeight,transform:"translate3d("+t+"px, "+i+"px, 0)"})},e.prototype.roundNumber=function(e){return Math.round(1e5*e)/1e5},e.prototype.zoomIn=function(){var e=this.roundNumber(this._scale+.05);0<e&&e<=1?this.setScale(e):this.setScale(1)},e.prototype.zoomOut=function(){var e=this.roundNumber(this._scale-.05);e>this.minScale&&e<=1?this.setScale(e):this.fit()},e.prototype.ngAfterContentInit=function(){this.setImageUrl(this.src)},e.prototype.center=function(e){e||(e=this.imgContainer.nativeElement.firstElementChild);var t={width:e.width+"px",height:e.height+"px",transform:this.customCenter(e.width,e.height)};this._setStylesForContImg(t)},e.prototype.setImageUrl=function(e){var t=this;if(this.src=e){var i=new Image;i.src=e,i.addEventListener("error",function(e){t.error.emit({name:t._fileName,type:null,base64:null,base64Image:null})}),i.addEventListener("load",function(){t._imgLoaded(i),t.loaded.emit(null),t.isLoaded=!0,t.cd.markForCheck()})}},e.prototype.max=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Math.max.apply(Math,function i(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}(e))},e.prototype.imageSmoothingQuality=function(i,e,t){var n=Math.ceil(Math.log(this.max(i.width,i.height)/this.max(e.height,e.width))/Math.log(2))-1;n=n<=0?0:n;var o=Array.from(Array(n).keys()),r=i.getContext("2d"),a=Math.pow(10*t,n)/Math.pow(10,n);if(n){var s=i.width*t,h=i.height*t;r.globalCompositeOperation="copy",o.forEach(function(e,t){r.drawImage(i,0,0,s,h)})}var l=document.createElement("canvas"),p=l.getContext("2d");return l.width=e.width,l.height=e.height,p.drawImage(i,0,0,i.width*a,i.height*a,0,0,l.width,l.height),l},e.prototype.crop=function(e){var t=e?n.mergeDeep({},this.config||p,e):this.config,i=this.cropp(t);return{base64:i,base64Image:i,type:this.defaultType||this.config.type,name:this._fileName}},e.prototype.cropp=function(e){var t=document.createElement("canvas"),i=this.croppingContainer.nativeElement.getBoundingClientRect(),n=this.imgContainer.nativeElement.firstElementChild.getBoundingClientRect(),o=i.left-n.left,r=i.top-n.top,a={width:e.width,height:e.height};t.width=a.width/this._scale,t.height=a.height/this._scale;var s=t.getContext("2d");e.fill&&(s.fillStyle=e.fill,s.fillRect(0,0,t.width,t.height)),s.drawImage(this._img,-o/this._scale,-r/this._scale);var h,l=t,p=e.antiAliased?.5:1;return 0===e.output?l=this.imageSmoothingQuality(l,a,p):"object"==typeof e.output&&(l=this.imageSmoothingQuality(l,e.output,p)),h=e.type?l.toDataURL("image/"+e.type):l.toDataURL(this.defaultType),this.result=h,this.cropped.emit({base64Image:h,base64:h,type:this.defaultType||e.type,name:this._fileName}),this.isCropped=!0,h},e.decorators=[{type:o.Component,args:[{changeDetection:o.ChangeDetectionStrategy.OnPush,preserveWhitespaces:!1,selector:"ly-cropping",template:'<div #_imgContainer\n[className]="classes.imgContainer"\n(slidestart)="_moveStart($event)"\n(slide)="_move($event)">\n  <img *ngIf="isLoaded" [src]="src">\n</div>\n<div #_croppingContainer *ngIf="isLoaded; else content" [className]="classes.croppingContainer" [ngStyle]="{\n  width: config.width + \'px\',\n  height: config.height + \'px\'\n}"></div>\n<ng-template #content>\n  <div [className]="classes.croppContent">\n    <input #_fileInput type="file" (change)="selectInputEvent($event)" accept="image/*">\n    <ng-content></ng-content>\n  </div>\n</ng-template>\n'}]}],e.ctorParameters=function(){return[{type:o.Renderer2},{type:n.LyTheme2},{type:o.ElementRef},{type:o.ChangeDetectorRef}]},e.propDecorators={imgContainer:[{type:o.ViewChild,args:["_imgContainer"]}],croppingContainer:[{type:o.ViewChild,args:["_croppingContainer"]}],src:[{type:o.Input}],config:[{type:o.Input}],loaded:[{type:o.Output}],cropped:[{type:o.Output}],error:[{type:o.Output}]},e}(),c=function(e){return parseFloat(e.toFixed(0))},f=function(){function e(){}return e.decorators=[{type:o.NgModule,args:[{imports:[i.CommonModule],exports:[g],providers:[{provide:t.HAMMER_GESTURE_CONFIG,useClass:n.LyHammerGestureConfig}],declarations:[g]}]}],e}();e.ImgResolution=h,e.ImageResolution=l,e.LyResizingCroppingImages=g,e.LyResizingCroppingImageModule=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=alyle-ui-resizing-cropping-images.umd.min.js.map