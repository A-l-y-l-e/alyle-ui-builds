{"version":3,"file":"alyle-ui-ls.umd.js.map","sources":["ng://@alyle/ui/ls/minimal-localstorage.ts","ng://@alyle/ui/ls/ls.module.ts"],"sourcesContent":["import {\n  NgModule,\n  ModuleWithProviders,\n  ElementRef,\n  ViewContainerRef,\n  Injectable,\n  Inject\n}                          from '@angular/core';\nimport { PLATFORM_ID } from '@angular/core';\nimport { isPlatformBrowser, isPlatformServer } from '@angular/common';\nimport { Observable ,  Subject ,  BehaviorSubject ,  Observer ,  fromEvent }      from 'rxjs';\nimport { CommonModule }    from '@angular/common';\n\nexport class MinimalStorage {\n  constructor(key$: string, val: any) {\n    localStorage.setItem(key$, JSON.stringify(val));\n  }\n}\n\n@Injectable()\nexport class MinimalLS {\n  private itemsSubject = new Map<string, BehaviorSubject<string>>();\n  private _prefix = '*ls*';\n  private storageEvent: Observable<any>;\n  private storage = new Subject();\n  private storageObservable: Observable<any>;\n  constructor(@Inject(PLATFORM_ID) private platformId: Object) {\n    if (isPlatformBrowser(this.platformId)) {\n      this.storageEvent = fromEvent(window, 'storage');\n      this.storageEvent.subscribe((e) => {\n        this.storage.next({\n          key: e.key,\n          value: e.newValue\n        });\n      });\n      this.storageObservable = this.storage.asObservable();\n    }\n  }\n\n  /**\n   * get boolean\n   */\n  hasItem(key$: string): boolean {\n    const key = this._addPrefix(key$);\n    if (isPlatformBrowser(this.platformId)) {\n      return !!localStorage.getItem(key);\n    }\n    if (isPlatformServer(this.platformId)) {\n      return false;\n    }\n  }\n  /**\n   * Set new item or replace item\n   */\n  setItem(key$: string, val: any, _storage = true) {\n    const key = this._addPrefix(key$);\n    if (_storage) {\n      if (isPlatformBrowser(this.platformId)) {\n        // tslint:disable-next-line:no-unused-expression\n        new MinimalStorage(key, val);\n      }\n    }\n    this.storage.next({\n      key: key,\n      value: this.item(key$)\n    });\n    // this.itemsSubject.set(key, new BehaviorSubject<string>(val));\n  }\n  /**\n   * Get Observable from localStorage\n   */\n  getItem(key$: string, before?: any): Observable<any> {\n    const key = this._addPrefix(key$);\n    const ob = new Observable((observer) => {\n      if (this.hasItem(key$)) {\n        observer.next(this.item(key$));\n      }\n      this.storageObservable.subscribe((e) => {\n        if (key === e.key) {\n          observer.next(e.value);\n        }\n      });\n    });\n    return ob;\n  }\n  /**\n   * Get value from localstorage\n   */\n  item(key$: string): any {\n    const key = this._addPrefix(key$);\n    try {\n      return JSON.parse(window.localStorage[key]);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  private _addPrefix(val) {\n    return `{\"${this._prefix}\":\"${val}\"}`;\n  }\n  private _removePrefix(val) {\n    try {\n      return JSON.parse(val)[this._prefix];\n    } catch (e) {\n      return null;\n    }\n  }\n}\n\n","import {\n  NgModule, ModuleWithProviders,\n  ViewContainerRef, SkipSelf, Optional,\n  InjectionToken }                       from '@angular/core';\nimport { MinimalLS } from './minimal-localstorage';\n\n@NgModule({\n  providers: [\n    MinimalLS\n  ]\n})\nexport class MinimalLSModule { }\n"],"names":["Subject","isPlatformBrowser","fromEvent","isPlatformServer","Observable","Injectable","Inject","PLATFORM_ID","NgModule"],"mappings":"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"}
