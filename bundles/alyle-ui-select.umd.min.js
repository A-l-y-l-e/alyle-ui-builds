!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/animations"),require("@angular/core"),require("@angular/forms"),require("@alyle/ui/field"),require("@alyle/ui"),require("rxjs"),require("rxjs/operators"),require("@angular/common"),require("@alyle/ui/checkbox")):"function"==typeof define&&define.amd?define("@alyle/ui/select",["exports","@angular/animations","@angular/core","@angular/forms","@alyle/ui/field","@alyle/ui","rxjs","rxjs/operators","@angular/common","@alyle/ui/checkbox"],t):t(((e=e||self).ly=e.ly||{},e.ly.select={}),e.ng.animations,e.ng.core,e.ng.forms,e.ly.field,e.ly.core,e.rxjs,e.rxjs.operators,e.ng.common,e.ly.checkbox)}(this,function(e,t,n,i,o,s,r,l,a,c){"use strict";var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function h(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function p(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r}function d(e,t){return function(n,i){t(n,i,e)}}function f(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function y(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,s=n.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)r.push(i.value)}catch(l){o={error:l}}finally{try{i&&!i.done&&(n=s["return"])&&n.call(s)}finally{if(o)throw o.error}}return r}function _(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}var g=-2,m=function(e){return{$priority:g,root:{display:"block",paddingAfter:"1em",minWidth:"3em",minHeight:"1.5em","-webkit-tap-highlight-color":"transparent","&":e.select?e.select.root:null},container:{background:e.background.primary["default"],borderRadius:"2px",boxShadow:s.shadowBuilder(4),display:"block",transformOrigin:"inherit",pointerEvents:"all",overflow:"auto",maxHeight:"256px"},valueText:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},option:{display:"flex",fontFamily:e.typography.fontFamily,color:e.text["default"],"-webkit-tap-highlight-color":"transparent",backgroundColor:"rgba(0, 0, 0, 0)",border:0,padding:"0 1em",margin:0,outline:"none",boxSizing:"border-box",position:"relative",justifyContent:"flex-start",alignItems:"center",alignContent:"center","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",userSelect:"none",lineHeight:"3em",height:"3em",cursor:"pointer"},optionText:{"ly-checkbox ~ &":{marginBefore:"-16px"}},content:{padding:0,display:"flex",justifyContent:"inherit",alignItems:"inherit",alignContent:"inherit",width:"100%",height:"100%",boxSizing:"border-box"}}},v=[t.trigger("selectEnter",[t.transition("void => in",[t.animate("125ms cubic-bezier(0, 0, 0.2, 1)",t.keyframes([t.style({opacity:0,transform:"scaleY(0.9)"}),t.style({opacity:1,transform:"scaleY(1)"})]))])]),t.trigger("selectLeave",[t.transition("* => void",t.animate("100ms 25ms linear",t.style({opacity:0})))])],b=function(){},C=s.mixinTabIndex(b),x=function(e){function t(t,n,i,s,l,a,c,u,h,p){var d=e.call(this)||this;return d._theme=t,d._renderer=n,d._el=i,d._overlay=s,d._field=l,d._cd=a,d._ngZone=c,d.ngControl=u,d._parentForm=h,d._parentFormGroup=p,d.classes=d._theme.addStyleSheet(m),d._disabled=!1,d._required=!1,d.stateChanges=new r.Subject,d._form=d._parentForm||d._parentFormGroup,d._valueKey=k,d._valueKeyFn=M,d._focused=!1,d.errorState=!1,d._destroy=new r.Subject,d.onChange=function(e){},d.onTouched=function(){},d.ngControl&&(d.ngControl.valueAccessor=d),d._cursorClass=d._theme.addStyle("lyField.select",{"& {container}":{cursor:"pointer"}},d._field._getHostElement(),null,g,o.STYLES),d}var a;return h(t,e),a=t,t.prototype._onBlur=function(){!1===this._focused||this._opened||(this._focused=!1,this.stateChanges.next())},t.prototype._onFocus=function(){!0===this._focused||this.disabled||(this._focused=!0,this.stateChanges.next())},t.prototype._endAnimation=function(e){"void"===e.toState&&this._overlayRef&&(this._overlayRef.remove(),this._overlayRef=null)},Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){var t=this;if(e!==this.value&&this._selectionModel){if(this._value=e,this.writeValue(e),this.options)if(this.multiple){if(Array.isArray(this.value)){var n=[];if(this.options.forEach(function(e){t.value.some(function(n){return t._valueKey(n)===t._valueKeyFn(e)})&&n.push(e)}),n.length){var i=this._selectionModel.selected;this._selectionModel.clear(),n.forEach(function(e){return e.select()}),i.length&&i.forEach(function(e){e.ngOnChanges(),e._cd.markForCheck()})}}}else{var o=this._selectionModel.selected;this._selectionModel.clear(),o.length&&o.forEach(function(e){e.ngOnChanges(),e._cd.markForCheck()});var s=this.options.find(function(e){return t._valueKeyFn(e)===t.valueKey(t.value)});s&&s.select()}this.stateChanges.next(),this._cd.markForCheck()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled},set:function(e){e!==this._disabled&&(this._disabled=s.toBoolean(e),this._field&&(!e&&this._hasDisabledClass?(this._renderer.removeClass(this._field._getHostElement(),this._field.classes.disabled),this._cursorClass&&this._renderer.addClass(this._field._getHostElement(),this._cursorClass),this._hasDisabledClass=undefined):e&&(this._renderer.addClass(this._field._getHostElement(),this._field.classes.disabled),this._cursorClass&&this._renderer.removeClass(this._field._getHostElement(),this._cursorClass),this._hasDisabledClass=!0)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"required",{get:function(){return this._required},set:function(e){this._required=s.toBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"multiple",{get:function(){return this._multiple},set:function(e){this._multiple=s.toBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueKey",{get:function(){return this._valueKey},set:function(e){this._valueKeyFn=function(t){return e(M(t))},this._valueKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"placeholder",{get:function(){return this._placeholder},set:function(e){this._placeholder=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){var e=this.value;return this.multiple?this._selectionModel.isEmpty():null==e||this._selectionModel.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"floatingLabel",{get:function(){return!!this._opened||!this.empty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"triggerValue",{get:function(){if(this._multiple){var e=this._selectionModel.selected.map(function(e){return e.viewValue});return this._theme.variables.direction===s.Dir.rtl&&e.reverse(),e.join(", ")}return this._selectionModel.selected[0].viewValue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){var e=this._selectionModel.selected;return this.multiple?e.map(function(e){return e.value}):e[0].value},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var e=this;this._selectionModel=new s.LySelectionModel({multiple:!!this.multiple||undefined,getKey:this._valueKeyFn});var t=this.ngControl;t&&t.statusChanges&&t.statusChanges.pipe(l.takeUntil(this._destroy)).subscribe(function(){e.disabled=!!t.disabled}),this._renderer.addClass(this._field._getHostElement(),this._field.classes.selectArrow),this._renderer.addClass(this._el.nativeElement,this._field.classes.inputNative),this._renderer.addClass(this._el.nativeElement,this.classes.root)},t.prototype.ngDoCheck=function(){var e=this.errorState,t=!!(this.ngControl&&this.ngControl.invalid&&(this.ngControl.touched||this._form&&this._form.submitted));if(t!==e&&(this.errorState=t,this._field)){var n=this._field.classes.errorState;t?(this._renderer.addClass(this._field._getHostElement(),n),this._errorClass=n):this._errorClass&&(this._renderer.removeClass(this._field._getHostElement(),n),this._errorClass=undefined),this.stateChanges.next()}},t.prototype.ngAfterContentInit=function(){var e=this;Promise.resolve().then(function(){e.value=e.ngControl?e.ngControl.value:e._value,e.stateChanges.next(),e._cd.markForCheck()})},t.prototype.ngAfterViewInit=function(){var e=this;this.options&&this.options.changes.pipe(l.takeUntil(this._destroy)).subscribe(function(){var t=[];e.options.forEach(function(e){e.isSelected&&t.push(e)}),t.length&&(e._selectionModel.clear(),t.forEach(function(t){return e._selectionModel.select(t)}))})},t.prototype.ngOnDestroy=function(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete(),this._overlayRef&&this._overlayRef.destroy()},t.prototype.open=function(){var e=this;this.disabled||(this._opened=!0,this.stateChanges.next(),this._overlayRef=this._overlay.create(this.templateRef,null,{styles:{top:0,left:0,pointerEvents:null},fnDestroy:this.close.bind(this),onResizeScroll:this._updatePlacement.bind(this)}),this._ngZone.onStable.pipe(l.take(1)).subscribe(function(){return e._updatePlacement()}))},t.prototype.close=function(){this._overlayRef&&(this.onTouched(),this._overlayRef.detach(),this._opened=!1,this._getHostElement().focus(),this.stateChanges.next())},t.prototype.onContainerClick=function(){this.open(),this._getHostElement().focus()},t.prototype.focus=function(){this._getHostElement().focus()},t.prototype._getHostElement=function(){return this._el.nativeElement},t.prototype.writeValue=function(e){this.options&&(this.value=e)},t.prototype.registerOnChange=function(e){var t=this;this.onChange=function(n){e(t.value)}},t.prototype.registerOnTouched=function(e){this.onTouched=e},t.prototype.setDisabledState=function(e){this.disabled=e,this._cd.markForCheck(),this.stateChanges.next()},t.prototype._updatePlacement=function(){var e,t=this._overlayRef.containerElement,n=t.querySelector("div"),i=this.valueTextDivRef.nativeElement;e=this.multiple?i.offsetWidth+64:i.offsetWidth+32,this._renderer.setStyle(n,"height","initial"),this._renderer.setStyle(n,"width",e+"px");var o=this._selectionModel.isEmpty()?t.querySelector("ly-option"):this._selectionModel.selected[0]._getHostElement(),r={y:-(i.offsetHeight/2+o.offsetTop+o.offsetHeight/2),x:-16};n.scrollHeight!==n.offsetHeight&&(n.scrollTop=o.offsetTop,n.scrollTop===o.offsetTop?n.scrollTop=n.scrollTop-n.offsetHeight/2+o.offsetHeight/2:n.scrollTop=n.scrollTop-(n.offsetHeight/2-(o.offsetTop-n.scrollTop))+o.offsetHeight/2,r.y=n.scrollTop+r.y),this.multiple&&(r.x-=24);var l=new s.Positioning(s.YPosition.below,s.XPosition.after,null,i,t,this._theme.variables,r,!1);this._renderer.setStyle(t,"transform","translate3d("+l.x+"px, "+l.y+"px, 0)"),this._renderer.setStyle(t,"transform-origin",l.ox+" "+l.oy+" 0"),this._renderer.setStyle(n,"height",l.height);var a="initial"===l.width?e+"px":l.width;this._renderer.setStyle(n,"width",a)},p([n.ViewChild(n.TemplateRef,{"static":!1}),f("design:type",n.TemplateRef)],t.prototype,"templateRef",void 0),p([n.ViewChild("valueText",{"static":!1}),f("design:type",n.ElementRef)],t.prototype,"valueTextDivRef",void 0),p([n.ViewChild(n.forwardRef(function(){return E}),{"static":!1}),f("design:type",n.QueryList)],t.prototype,"_options",void 0),p([n.ContentChildren(n.forwardRef(function(){return E}),{descendants:!0}),f("design:type",n.QueryList)],t.prototype,"options",void 0),p([n.HostListener("blur"),f("design:type",Function),f("design:paramtypes",[]),f("design:returntype",void 0)],t.prototype,"_onBlur",null),p([n.HostListener("focus"),f("design:type",Function),f("design:paramtypes",[]),f("design:returntype",void 0)],t.prototype,"_onFocus",null),p([n.Input(),f("design:type",Object),f("design:paramtypes",[Object])],t.prototype,"value",null),p([n.Input(),f("design:type",Boolean),f("design:paramtypes",[Boolean])],t.prototype,"disabled",null),p([n.Input(),f("design:type",Boolean),f("design:paramtypes",[Boolean])],t.prototype,"required",null),p([n.Input(),f("design:type",Boolean),f("design:paramtypes",[Boolean])],t.prototype,"multiple",null),p([n.Input(),f("design:type",Function),f("design:paramtypes",[Function])],t.prototype,"valueKey",null),p([n.Input(),f("design:type",String),f("design:paramtypes",[String])],t.prototype,"placeholder",null),t=a=p([n.Component({selector:"ly-select",template:'<div [className]="classes.valueText" #valueText>{{ empty ? \'\\u00A0\' : triggerValue }}</div>\n<ng-template>\n  <div #container [className]="classes.container" [@selectEnter]="\'in\'" (@selectLeave.done)="_endAnimation($event)">\n    <ng-content></ng-content>\n  </div>\n</ng-template>',changeDetection:n.ChangeDetectionStrategy.OnPush,exportAs:"lySelect",host:{"[attr.tabindex]":"tabIndex"},animations:_(v),inputs:["tabIndex"],providers:[{provide:o.LyFieldControlBase,useExisting:a}]}),d(4,n.Optional()),d(7,n.Optional()),d(7,n.Self()),d(8,n.Optional()),d(9,n.Optional()),f("design:paramtypes",[s.LyTheme2,n.Renderer2,n.ElementRef,s.LyOverlay,o.LyField,n.ChangeDetectorRef,n.NgZone,i.NgControl,i.NgForm,i.FormGroupDirective])],t)}(C),S=function(e,t){this._theme=e,this._ngZone=t},O=s.mixinStyleUpdater(s.mixinBg(s.mixinColor(s.mixinRaised(s.mixinDisabled(s.mixinOutlined(s.mixinElevation(s.mixinShadowColor(s.mixinDisableRipple(S))))))))),E=function(e){function t(t,n,i,o,s,r,l){var a=e.call(this,s,l)||this;return a._select=t,a._el=n,a._rippleService=i,a._cd=r,a.classes=a._theme.addStyleSheet(m,g),o.addClass(n.nativeElement,a.classes.option),a.setAutoContrast(),a._triggerElement=n,a}return h(t,e),t.prototype._onClick=function(){this._select.multiple?this.toggle():(this.select(),this._select.close()),this._select.onChange(this._select._value)},Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewValue",{get:function(){return(this._getHostElement().textContent||"").trim()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_color",{get:function(){return this._select._selectionModel.isSelected(this)?this._select._field.color:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSelected",{get:function(){return this._select._selectionModel.isSelected(this)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){null==this.disableRipple&&(this.disableRipple=!1)},t.prototype.ngOnChanges=function(){this.updateStyle(this._el)},t.prototype.select=function(){if(!this.disabled){if(this._select.multiple){var e=this._select._selectionModel.selected;this._select._selectionModel.select(this),this._select._value=this._select._selectionModel.selected.map(function(e){return e.value}),this.updateStyle(this._el),e.length&&e.forEach(function(e){return e.ngOnChanges()})}else if(!this._select._selectionModel.isSelected(this)){e=this._select._selectionModel.selected;this._select._selectionModel.select(this),this._select._value=this._value,this.updateStyle(this._el),e.length&&e.forEach(function(e){return e.ngOnChanges()})}this._select._cd.markForCheck(),this._select.stateChanges.next(),this._cd.markForCheck()}},t.prototype.toggle=function(){if(!this.disabled){if(this._select.multiple){var e=this._select._selectionModel.selected;this._select._selectionModel.toggle(this),this._select._value=this._select._selectionModel.selected.map(function(e){return e.value}),this.updateStyle(this._el),e.length&&e.forEach(function(e){return e.ngOnChanges()})}else if(!this._select._selectionModel.isSelected(this)){e=this._select._selectionModel.selected;this._select._selectionModel.toggle(this),this._select._value=this._value,this.updateStyle(this._el),e.length&&e.forEach(function(e){return e.ngOnChanges()})}this._select._cd.markForCheck(),this._select.stateChanges.next(),this._cd.markForCheck()}},t.prototype._getHostElement=function(){return this._el.nativeElement},p([n.ViewChild("rippleContainer",{"static":!1}),f("design:type",n.ElementRef)],t.prototype,"_rippleContainer",void 0),p([n.HostListener("click"),f("design:type",Function),f("design:paramtypes",[]),f("design:returntype",void 0)],t.prototype,"_onClick",null),p([n.Input("value"),f("design:type",Object),f("design:paramtypes",[Object])],t.prototype,"value",null),t=p([n.Component({selector:"ly-option",template:'<span [className]="classes.content">\n  <ly-checkbox [disabled]="disabled"\n    [color]="_color"\n    [checked]="isSelected"\n    *ngIf="_select.multiple"\n    (click)="$event.preventDefault()"\n  ></ly-checkbox>\n  <span [className]="classes.optionText"><ng-content></ng-content></span>\n</span>\n<div #rippleContainer [className]="_rippleService.classes.container"></div>',changeDetection:n.ChangeDetectionStrategy.OnPush,inputs:["bg","color","raised","disabled","outlined","elevation","shadowColor","disableRipple"]}),d(0,n.Host()),f("design:paramtypes",[x,n.ElementRef,s.LyRippleService,n.Renderer2,s.LyTheme2,n.ChangeDetectorRef,n.NgZone])],t)}(O);function k(e){return e}function M(e){return e.value}var w=function(){function e(){}return e=p([n.NgModule({declarations:[x,E],imports:[a.CommonModule,s.LyCommonModule,c.LyCheckboxModule,s.LyOverlayModule],exports:[x,E,s.LyCommonModule]})],e)}();e.LyOption=E,e.LyOptionBase=S,e.LyOptionMixinBase=O,e.LySelect=x,e.LySelectBase=b,e.LySelectMixinBase=C,e.LySelectModule=w,e.STYLES=m,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=alyle-ui-select.umd.min.js.map