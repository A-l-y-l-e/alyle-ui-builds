{"version":3,"file":"alyle-ui-ls.js.map","sources":["ng://@alyle/ui/ls/minimal-localstorage.ts","ng://@alyle/ui/ls/ls.module.ts"],"sourcesContent":["import {\n  NgModule,\n  ModuleWithProviders,\n  ElementRef,\n  ViewContainerRef,\n  Injectable,\n  Inject\n}                          from '@angular/core';\nimport { PLATFORM_ID } from '@angular/core';\nimport { isPlatformBrowser, isPlatformServer } from '@angular/common';\nimport { Observable ,  Subject ,  BehaviorSubject ,  Observer ,  fromEvent }      from 'rxjs';\nimport { CommonModule }    from '@angular/common';\n\nexport class MinimalStorage {\n  constructor(key$: string, val: any) {\n    localStorage.setItem(key$, JSON.stringify(val));\n  }\n}\n\n@Injectable()\nexport class MinimalLS {\n  private itemsSubject = new Map<string, BehaviorSubject<string>>();\n  private _prefix = '*ls*';\n  private storageEvent: Observable<any>;\n  private storage = new Subject();\n  private storageObservable: Observable<any>;\n  constructor(@Inject(PLATFORM_ID) private platformId: Object) {\n    if (isPlatformBrowser(this.platformId)) {\n      this.storageEvent = fromEvent(window, 'storage');\n      this.storageEvent.subscribe((e) => {\n        this.storage.next({\n          key: e.key,\n          value: e.newValue\n        });\n      });\n      this.storageObservable = this.storage.asObservable();\n    }\n  }\n\n  /**\n   * get boolean\n   */\n  hasItem(key$: string): boolean {\n    const key = this._addPrefix(key$);\n    if (isPlatformBrowser(this.platformId)) {\n      return !!localStorage.getItem(key);\n    }\n    if (isPlatformServer(this.platformId)) {\n      return false;\n    }\n  }\n  /**\n   * Set new item or replace item\n   */\n  setItem(key$: string, val: any, _storage = true) {\n    const key = this._addPrefix(key$);\n    if (_storage) {\n      if (isPlatformBrowser(this.platformId)) {\n        // tslint:disable-next-line:no-unused-expression\n        new MinimalStorage(key, val);\n      }\n    }\n    this.storage.next({\n      key: key,\n      value: this.item(key$)\n    });\n    // this.itemsSubject.set(key, new BehaviorSubject<string>(val));\n  }\n  /**\n   * Get Observable from localStorage\n   */\n  getItem(key$: string, before?: any): Observable<any> {\n    const key = this._addPrefix(key$);\n    const ob = new Observable((observer) => {\n      if (this.hasItem(key$)) {\n        observer.next(this.item(key$));\n      }\n      this.storageObservable.subscribe((e) => {\n        if (key === e.key) {\n          observer.next(e.value);\n        }\n      });\n    });\n    return ob;\n  }\n  /**\n   * Get value from localstorage\n   */\n  item(key$: string): any {\n    const key = this._addPrefix(key$);\n    try {\n      return JSON.parse(window.localStorage[key]);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  private _addPrefix(val) {\n    return `{\"${this._prefix}\":\"${val}\"}`;\n  }\n  private _removePrefix(val) {\n    try {\n      return JSON.parse(val)[this._prefix];\n    } catch (e) {\n      return null;\n    }\n  }\n}\n\n","import {\n  NgModule, ModuleWithProviders,\n  ViewContainerRef, SkipSelf, Optional,\n  InjectionToken }                       from '@angular/core';\nimport { MinimalLS } from './minimal-localstorage';\n\n@NgModule({\n  providers: [\n    MinimalLS\n  ]\n})\nexport class MinimalLSModule { }\n"],"names":[],"mappings":"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"}
